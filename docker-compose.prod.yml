services:
  # Public website served via nginx
  website:
    image: nginx:1.28-alpine
    container_name: way-cms-website
    ports:
      - "8080:80"
    volumes:
      - ${WEBSITE_DIR:-./website}:/usr/share/nginx/html:ro
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped
    networks:
      - way-cms-network

  # CMS admin interface - using Docker Hub image
  # Note: Set DOCKER_USERNAME env var or replace 'drumsergio' with your Docker Hub username
  # Set CMS_VERSION env var to use a specific version (defaults to v1.2.14)
  # Example: CMS_VERSION=v1.2.14 or CMS_VERSION=v1.2.13
  cms:
    image: ${DOCKER_USERNAME:-drumsergio}/way-cms:${CMS_VERSION:-v1.2.14}
    container_name: way-cms-admin
    ports:
      - "5001:5000"
    volumes:
      - ${WEBSITE_DIR:-./website}:/var/www/html:rw
      - ./.way-cms-backups:/.way-cms-backups
    environment:
      # Base directory for website files
      - CMS_BASE_DIR=/var/www/html
      
      # Authentication (use either CMS_PASSWORD or CMS_PASSWORD_HASH)
      - CMS_USERNAME=${CMS_USERNAME:-admin}
      - CMS_PASSWORD=${CMS_PASSWORD:-admin}
      - CMS_PASSWORD_HASH=${CMS_PASSWORD_HASH:-}
      
      # Security
      - SECRET_KEY=${SECRET_KEY:-change-me-in-production-please}
      - READ_ONLY_MODE=${READ_ONLY_MODE:-false}
      
      # Session configuration (in minutes, default 24 hours)
      - SESSION_TIMEOUT_MINUTES=${SESSION_TIMEOUT_MINUTES:-1440}
      
      # Website display settings
      - WEBSITE_URL=${WEBSITE_URL:-}
      - WEBSITE_NAME=${WEBSITE_NAME:-}
      
      # Automatic backups (enabled by default)
      - AUTO_BACKUP_ENABLED=${AUTO_BACKUP_ENABLED:-true}
      
      # Flask configuration
      - PORT=5000
      - FLASK_APP=app.py
    restart: unless-stopped
    networks:
      - way-cms-network
    depends_on:
      - website

networks:
  way-cms-network:
    driver: bridge

volumes:
  website-data:
    driver: local
