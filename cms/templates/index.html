{% extends "base.html" %}

{% block title %}Way-CMS - File Editor{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.css">
<style>
    .CodeMirror {
        height: calc(100vh - 200px);
        font-size: 14px;
        border-radius: 0 0 8px 8px;
    }
    .editor-with-preview {
        display: flex;
        height: calc(100vh - 200px);
        gap: 0;
        position: relative;
    }
    .editor-pane {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 200px;
        max-width: 80%;
        resize: horizontal;
        overflow: auto;
    }
    .preview-pane {
        flex: 1;
        border-left: 3px solid #3e3e42;
        background: #f5f5f5;
        min-width: 200px;
        max-width: 80%;
        position: relative;
        box-shadow: -2px 0 8px rgba(0,0,0,0.1);
        resize: horizontal;
        overflow: hidden;
    }
    .resize-handle {
        width: 5px;
        background: #3e3e42;
        cursor: col-resize;
        flex-shrink: 0;
        position: relative;
        z-index: 10;
    }
    .resize-handle:hover {
        background: #007acc;
    }
    .resize-handle-vertical {
        height: 5px;
        background: #3e3e42;
        cursor: row-resize;
        flex-shrink: 0;
    }
    .resize-handle-vertical:hover {
        background: #007acc;
    }
    .preview-pane::before {
        content: attr(data-preview-title);
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        z-index: 10;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    /* Header styles live in static/css/style.css */
    /* Three-dot context menu for files */
    .context-menu-btn {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 0.25rem 0.5rem;
        font-size: 1rem;
        border-radius: 4px;
        transition: all 0.2s;
    }
    .context-menu-btn:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
    }
    .context-menu {
        position: absolute;
        right: 0;
        top: 100%;
        background: var(--bg-secondary);
        min-width: 180px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.1) inset;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        z-index: 10000;
        display: none;
        overflow: hidden;
        margin-top: 0.25rem;
        backdrop-filter: blur(10px);
    }
    .context-menu.show {
        display: block;
    }
    /* Backdrop overlay for context menu */
    .context-menu-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.3);
        z-index: 9999;
        display: none;
    }
    .context-menu-backdrop.show {
        display: block;
    }
    /* Create button styling */
    .btn-create {
        flex: 1;
        padding: 0.5rem 0.75rem;
        background: linear-gradient(135deg, #3e3e42 0%, #2a2d2e 100%);
        border: 1px solid var(--border-color);
        border-radius: 6px;
        color: var(--text-primary);
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.35rem;
        transition: all 0.2s ease;
    }
    .btn-create:hover {
        background: linear-gradient(135deg, #505052 0%, #3e3e42 100%);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        border-color: var(--accent-color);
    }
    .btn-create:active {
        transform: translateY(0);
    }
    /* Website link styling */
    .website-link {
        color: #007acc;
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        padding: 0.5rem 0.75rem;
        border-radius: 6px;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    .website-link:hover {
        background: rgba(0, 122, 204, 0.1);
        color: #0098ff;
        text-decoration: none;
    }
    .context-menu a {
        color: var(--text-primary);
        padding: 0.5rem 0.75rem;
        text-decoration: none;
        display: block;
        cursor: pointer;
        font-size: 0.8rem;
        transition: background 0.2s;
    }
    .context-menu a:hover {
        background: var(--bg-tertiary);
    }
    .context-menu a.danger {
        color: #f44336;
    }
    .context-menu a.danger:hover {
        background: rgba(244, 67, 54, 0.1);
    }
    /* File size hidden by default */
    .file-size {
        display: none;
    }
    .show-file-sizes .file-size {
        display: inline;
    }
    /* Folder tree styles */
    .folder-contents {
        margin-left: 1.25rem;
        border-left: 1px solid var(--border-color);
        display: none;
    }
    .folder-contents.expanded {
        display: block;
    }
    .dir-item .folder-toggle {
        cursor: pointer;
        transition: transform 0.2s;
        display: inline-block;
        width: 16px;
        text-align: center;
    }
    .dir-item.expanded .folder-toggle {
        transform: rotate(90deg);
    }
    .preview-iframe {
        width: 100%;
        height: 100%;
        border: none;
        margin-top: 30px;
        background: white;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
    }
    /* Search history items */
    .search-history-item {
        display: inline-block;
        padding: 0.2rem 0.5rem;
        margin: 0.15rem;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 3px;
        cursor: pointer;
        font-size: 0.75rem;
        transition: all 0.2s;
    }
    .search-history-item:hover {
        background: var(--accent-color);
        color: white;
    }
    /* Progress indicator */
    .progress-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: transparent;
        z-index: 10000;
        display: none;
    }
    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        width: 0%;
        transition: width 0.3s ease;
    }
    .progress-container.active {
        display: block;
    }
    /* File filter highlight */
    .file-item.hidden, .dir-item.hidden {
        display: none !important;
    }
    .file-item.filter-highlight, .dir-item.filter-highlight {
        background: rgba(102, 126, 234, 0.2) !important;
        border-left: 3px solid #667eea;
    }
</style>
{% endblock %}

{% block content %}
<!-- Progress indicator -->
<div id="progress-container" class="progress-container">
    <div id="progress-bar" class="progress-bar"></div>
</div>

<header class="header">
    <div style="display: flex; align-items: center; gap: 1rem;">
        <h1 class="logo-title">Way-CMS</h1>
        {% if website_url %}
        <a href="{{ website_url }}" target="_blank" class="website-link" title="View live website">
            üåê Live Website
        </a>
        {% endif %}
    </div>
    <div class="header-actions" id="header-actions">
        <div class="header-actions-main" id="header-actions-main">
                <!-- Primary buttons (can overflow on small screens) -->
                <button class="btn btn-primary header-action-btn is-overflowable" onclick="downloadCurrentFolder()" data-overflow-key="zip-export" data-overflow-label="üì¶ ZIP Export">üì¶ ZIP Export</button>
                <button class="btn btn-primary header-action-btn is-overflowable" onclick="showUploadZipDialog()" data-overflow-key="zip-import" data-overflow-label="üì§ ZIP Import">üì§ ZIP Import</button>

            <!-- Overflowable buttons (auto-moved into More when needed) -->
            <button class="btn btn-secondary header-action-btn is-overflowable" onclick="toggleSearch()" data-overflow-key="search" data-overflow-label="üîç Search">üîç Search</button>
            <button class="btn btn-secondary header-action-btn is-overflowable" onclick="toggleGlobalReplace()" data-overflow-key="replace" data-overflow-label="üîÑ Replace">üîÑ Replace</button>
            <button class="btn btn-secondary header-action-btn is-overflowable" onclick="toggleBackups()" data-overflow-key="backups" data-overflow-label="üíæ Backups">üíæ Backups</button>
            <button class="btn btn-secondary header-action-btn is-overflowable" onclick="refreshFiles()" data-overflow-key="refresh" data-overflow-label="üîÑ Refresh">üîÑ Refresh</button>
            <button class="btn btn-secondary header-action-btn is-overflowable" onclick="showUploadFileDialog()" data-overflow-key="upload-file" data-overflow-label="üìÅ Upload File">üìÅ Upload File</button>
        </div>

        <div class="menu-dropdown header-overflow" id="header-overflow" style="display: flex;">
            <button class="btn btn-secondary menu-toggle" onclick="toggleHeaderMenu(event)" id="header-menu-toggle" aria-haspopup="true" aria-expanded="false">‚ò∞</button>
            <div class="menu-dropdown-content" id="header-menu-dropdown" role="menu" aria-labelledby="header-menu-toggle">
                <div id="header-menu-overflow-items"></div>
                <div class="menu-divider" id="header-menu-overflow-divider" style="display:none;"></div>

                <!-- Always-available items -->
                <a onclick="toggleFileSizeDisplay(); closeHeaderMenu();" id="toggle-filesize-btn" role="menuitem">üìè Show File Sizes</a>
                <a onclick="toggleTheme(); closeHeaderMenu();" id="theme-menu-btn" role="menuitem">üåì Toggle Theme</a>
                <div class="menu-divider"></div>
                <a onclick="showKeyboardShortcuts(); closeHeaderMenu();" role="menuitem">‚å®Ô∏è Keyboard Shortcuts</a>
                <a onclick="exportSettings(); closeHeaderMenu();" role="menuitem">üì§ Export Settings</a>
                <a onclick="importSettings(); closeHeaderMenu();" role="menuitem">üì• Import Settings</a>
                <div class="menu-divider"></div>
                <a href="{{ url_for('logout') }}" role="menuitem">üö™ Logout</a>
            </div>
        </div>
    </div>
</header>

<div class="main-layout">
    <aside class="sidebar">
        <div class="file-browser">
            <div class="breadcrumb" id="breadcrumb" data-folder-name="{{ folder_name }}">
                <span class="breadcrumb-item" onclick="navigateTo('')">{{ folder_name }}</span>
            </div>
            <div class="file-browser-actions" style="padding: 0.5rem;">
                <input type="text" id="file-filter" placeholder="Filter files... (e.g. *.html, *.css)" 
                       style="width: 100%; padding: 0.35rem; margin-bottom: 0.5rem; background: var(--bg-tertiary); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-primary);"
                       onkeyup="filterFiles(this.value)" oninput="filterFiles(this.value)">
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn-create" onclick="showCreateFileDialog()" title="Create New File">
                        <span style="font-size: 1.1rem;">‚ûï</span> File
                    </button>
                    <button class="btn-create" onclick="showCreateFolderDialog()" title="Create New Folder">
                        <span style="font-size: 1.1rem;">üìÅ</span> Folder
                    </button>
                </div>
            </div>
            <div class="file-list" id="fileList">
                <div class="loading">Loading files...</div>
            </div>
        </div>
    </aside>
    <div class="sidebar-resize-handle" id="sidebar-resize-handle"></div>

    <main class="editor-area">
        <div id="editor-toolbar" class="editor-toolbar" style="display: none;">
            <div class="file-info">
                <span id="current-file"></span>
                <span id="file-status" class="status"></span>
            </div>
            <div class="toolbar-actions">
                <button class="btn btn-primary" onclick="saveFile()">Save</button>
                <button class="btn btn-secondary" onclick="showFindReplace()">Find & Replace</button>
                <button class="btn btn-secondary" onclick="togglePreview()" id="preview-toggle">Preview</button>
                <button class="btn btn-secondary" onclick="closeEditor()">Close</button>
                <button class="btn btn-danger" onclick="deleteCurrentFile()">Delete</button>
            </div>
        </div>
        <div id="editor-container">
            <div class="welcome-message">
                <h2>Welcome to Way-CMS</h2>
                <p>Select a file from the sidebar to start editing</p>
                <p>Supported formats: HTML, CSS, JS, TXT, XML, JSON, MD</p>
            </div>
        </div>
    </main>
</div>

<!-- Find & Replace in Editor Modal -->
<div id="editor-find-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Find & Replace</h2>
            <button class="close-btn" onclick="closeEditorFindReplace()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Find:</label>
                <input type="text" id="editor-find-input" placeholder="Search text">
            </div>
            <div class="form-group">
                <label>Replace:</label>
                <input type="text" id="editor-replace-input" placeholder="Replace with">
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-primary" onclick="editorFindNext()">Find Next</button>
                <button class="btn btn-primary" onclick="editorReplace()">Replace</button>
                <button class="btn btn-primary" onclick="editorReplaceAll()">Replace All</button>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced Global Find & Replace Modal -->
<div id="global-replace-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2>Global Find & Replace</h2>
            <button class="close-btn" onclick="toggleGlobalReplace()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Find:</label>
                <input type="text" id="global-search-input" placeholder="Search text or regex pattern">
            </div>
            <div class="form-group">
                <label>Replace:</label>
                <input type="text" id="global-replace-input" placeholder="Replace with">
            </div>
            <div class="form-group">
                <label>File Pattern:</label>
                <input type="text" id="global-file-pattern" placeholder="*.html, *.css, etc." value="*">
            </div>
            <div class="form-group" style="display: flex; gap: 1rem;">
                <label><input type="checkbox" id="global-regex"> Use Regex</label>
                <label><input type="checkbox" id="global-case-sensitive"> Case Sensitive</label>
                <label><input type="checkbox" id="global-dry-run" checked> Dry Run (Preview Only)</label>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-primary" onclick="performGlobalSearch()">Search</button>
                <button class="btn btn-primary" onclick="performGlobalReplace()">Replace All</button>
            </div>
            <div id="search-history" class="search-history" style="margin-top: 0.75rem; padding: 0.5rem; background: var(--bg-tertiary); border-radius: 4px; font-size: 0.8rem;">
                <strong style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Recent Searches:</strong>
            </div>
            <div id="global-results" class="search-results" style="max-height: 400px; overflow-y: auto; margin-top: 1rem;"></div>
        </div>
    </div>
</div>

<!-- Backups Modal -->
<div id="backups-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2>Folder Backups: <span id="backups-folder-name"></span></h2>
            <button class="close-btn" onclick="closeBackupsModal()" style="font-size: 1.5rem; padding: 0; width: 32px; height: 32px;">&times;</button>
        </div>
        <div class="modal-body">
            <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <span style="color: var(--text-secondary);">Manage backups for the current folder</span>
                <button class="btn btn-primary" onclick="showCreateBackupDialog()">‚ûï Create Backup</button>
            </div>
            <div id="backups-list" style="max-height: 500px; overflow-y: auto;"></div>
        </div>
    </div>
</div>

<!-- Create Backup Dialog -->
<div id="create-backup-dialog" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>Create Folder Backup</h2>
            <button class="close-btn" onclick="closeCreateBackupDialog()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Backup Name:</label>
                <input type="text" id="backup-name-input" placeholder="e.g., mybackup (will create mybackup.zip)" value="">
                <small style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.25rem; display: block;">
                    This will create a ZIP backup of the entire folder
                </small>
            </div>
            <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeCreateBackupDialog()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmCreateBackup()">Create Backup</button>
            </div>
        </div>
    </div>
</div>

<!-- Create File/Folder Dialog -->
<div id="create-dialog" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2 id="create-dialog-title">Create</h2>
            <button class="close-btn" onclick="closeCreateDialog()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label id="create-dialog-label">Name:</label>
                <input type="text" id="create-dialog-input" placeholder="Enter name">
            </div>
            <button class="btn btn-primary" onclick="confirmCreate()">Create</button>
        </div>
    </div>
</div>

<!-- Rename Dialog -->
<div id="rename-dialog" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div class="modal-header">
            <h2>Rename</h2>
            <button class="close-btn" onclick="closeRenameDialog()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>New Name:</label>
                <input type="text" id="rename-input" placeholder="Enter new name">
            </div>
            <button class="btn btn-primary" onclick="confirmRename()">Rename</button>
        </div>
    </div>
</div>

<!-- Upload ZIP Dialog -->
<div id="upload-zip-dialog" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>ZIP Import</h2>
            <button class="close-btn" onclick="closeUploadZipDialog()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Select ZIP file to upload:</label>
                <input type="file" id="zip-file-input" accept=".zip" style="padding: 0.5rem; width: 100%;">
            </div>
            <div class="form-group">
                <label>Extract to path (optional, leave empty for root):</label>
                <input type="text" id="zip-extract-path" placeholder="e.g., folder/subfolder (optional)">
            </div>
            <div id="upload-progress" style="display: none; margin-top: 1rem;">
                <div class="loading">Uploading and extracting...</div>
            </div>
            <button class="btn btn-primary" onclick="uploadZipFile()" style="width: 100%;">Upload & Extract</button>
        </div>
    </div>
</div>

<!-- Upload File Dialog -->
<div id="upload-file-dialog" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Upload File</h2>
            <button class="close-btn" onclick="closeUploadFileDialog()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Select file to upload:</label>
                <input type="file" id="file-input" style="padding: 0.5rem; width: 100%;">
            </div>
            <div class="form-group">
                <label>Upload to path (optional, leave empty for current directory):</label>
                <input type="text" id="file-upload-path" placeholder="e.g., folder/subfolder (optional)" value="">
            </div>
            <div id="file-upload-progress" style="display: none; margin-top: 1rem;">
                <div class="loading">Uploading...</div>
            </div>
            <button class="btn btn-primary" onclick="uploadFile()" style="width: 100%;">Upload</button>
        </div>
    </div>
</div>

<!-- Keyboard Shortcuts Modal -->
<div id="keyboard-shortcuts-modal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2>Keyboard Shortcuts</h2>
            <button class="close-btn" onclick="closeKeyboardShortcuts()">&times;</button>
        </div>
        <div class="modal-body">
            <div style="line-height: 2;">
                <p><strong>Ctrl+S / Cmd+S</strong> - Save current file</p>
                <p><strong>Ctrl+F / Cmd+F</strong> - Find in editor</p>
                <p><strong>Ctrl+H / Cmd+H</strong> - Find & Replace in editor</p>
                <p><strong>Ctrl+G / Cmd+G</strong> - Find next</p>
                <p><strong>F3</strong> - Find next</p>
                <p><strong>Shift+F3</strong> - Find previous</p>
                <p><strong>Ctrl+/ / Cmd+/</strong> - Toggle comment (in editor)</p>
                <p><strong>Ctrl+Z / Cmd+Z</strong> - Undo</p>
                <p><strong>Ctrl+Shift+Z / Cmd+Shift+Z</strong> - Redo</p>
                <p><strong>Esc</strong> - Close dialogs</p>
            </div>
        </div>
    </div>
</div>

<!-- Search Modal (existing) -->
<div id="search-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Search Files</h2>
            <button class="close-btn" onclick="toggleSearch()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>Search Query:</label>
                <input type="text" id="search-query" placeholder="Enter text to search">
            </div>
            <div class="form-group">
                <label>File Pattern (optional):</label>
                <input type="text" id="search-pattern" placeholder="*.html, *.css, etc." value="*">
            </div>
            <button class="btn btn-primary" onclick="performSearch()">Search</button>
            <div id="search-results" class="search-results"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.js"></script>
<!-- Code folding addons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/xml-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/comment-fold.min.js"></script>
<!-- Selection and editing addons -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/selection/active-line.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closetag.min.js"></script>
<script>
    const API_BASE = '';
    let currentEditor = null;
    let currentFilePath = null;
    let currentPath = '';
    let previewEnabled = true; // Default ON for HTML files
    let renameTarget = null;
    let createType = null;
    let createPath = null;
</script>
{% endblock %}
